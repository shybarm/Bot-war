<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>War Room</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css">
  <style>
    body{
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(120,119,198,.22), transparent 55%),
        radial-gradient(900px 600px at 80% 15%, rgba(236,72,153,.14), transparent 55%),
        radial-gradient(900px 600px at 70% 90%, rgba(34,211,238,.10), transparent 55%),
        #070a12;
      color: rgba(255,255,255,.92);
    }
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 80px rgba(0,0,0,.55);
    }
    .muted{color: rgba(255,255,255,.62);}
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="text-4xl font-extrabold tracking-tight flex items-center gap-3">⚔️ War Room</div>
        <div class="muted mt-1">Real-time command center: carousel ticks, bot fights, trades, learning evaluations.</div>
      </div>
      <div class="flex items-center gap-2">
        <a class="px-3 py-2 rounded-xl glass hover:opacity-90" href="/">← Arena</a>
        <a class="px-3 py-2 rounded-xl glass hover:opacity-90" href="/api/runner/status" target="_blank">Runner Status</a>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-6">
      <!-- Left -->
      <div class="glass rounded-2xl p-4">
        <div class="text-lg font-extrabold">Bot bankrolls</div>
        <div class="muted text-sm">$100k start → $150k goal</div>
        <div id="bankrollGrid" class="mt-3 grid gap-2"></div>

        <div class="mt-6">
          <div class="text-lg font-extrabold">Runner</div>
          <div id="runnerInfo" class="muted text-sm mt-2">Loading…</div>
        </div>

        <div class="glass rounded-2xl p-4 mt-6">
          <div class="text-xs muted uppercase tracking-wider">Inspector</div>
          <div class="mt-2 text-sm">
            Click a bot card to open trade history + learning context.
          </div>
        </div>
      </div>

      <!-- Center/Right -->
      <div class="glass rounded-2xl p-4 lg:col-span-2">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-lg font-extrabold">Live feed</div>
            <div class="muted text-sm">WebSocket-first • REST fallback</div>
          </div>
          <div id="wsStatus" class="px-3 py-2 rounded-xl glass text-xs">WS: connecting…</div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
          <div class="glass rounded-2xl p-4">
            <div class="muted text-xs">Current carousel symbol</div>
            <div id="curSymbol" class="text-3xl font-extrabold mt-2">—</div>
          </div>
          <div class="glass rounded-2xl p-4">
            <div class="muted text-xs">Last event</div>
            <div id="lastEvent" class="text-sm mt-2 muted">—</div>
          </div>
        </div>

        <div class="mt-5">
          <div class="flex items-center justify-between">
            <div class="text-lg font-extrabold">Reasoning + events</div>
            <div class="muted text-xs">Persisted via DB hydration</div>
          </div>
          <div id="eventStream" class="mt-3 h-64 overflow-auto rounded-2xl glass p-3 text-sm">
            <div class="muted">Loading…</div>
          </div>
        </div>

        <div class="mt-6">
          <div class="flex items-center justify-between">
            <div class="text-lg font-extrabold">Trades stream</div>
            <div class="muted text-xs">Most recent executions</div>
          </div>
          <div class="mt-3 overflow-auto rounded-2xl glass">
            <table class="w-full text-sm">
              <thead class="text-xs muted">
                <tr>
                  <th class="text-left p-3">Time</th>
                  <th class="text-left p-3">Bot</th>
                  <th class="text-left p-3">Side</th>
                  <th class="text-left p-3">Symbol</th>
                  <th class="text-left p-3">Qty</th>
                  <th class="text-left p-3">Price</th>
                  <th class="text-left p-3">Why</th>
                </tr>
              </thead>
              <tbody id="tradeStreamBody">
                <tr><td class="p-3 muted" colspan="7">—</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div id="drawerBack" class="fixed inset-0 bg-black/60 hidden"></div>
  <div id="drawer" class="fixed top-0 right-0 h-full w-full sm:w-[520px] glass border-l border-white/10 translate-x-full transition-transform duration-200">
    <div class="p-4 flex items-center justify-between border-b border-white/10">
      <div>
        <div id="drawerTitle" class="font-extrabold text-lg">Bot</div>
        <div id="drawerSub" class="muted text-sm">—</div>
      </div>
      <button id="drawerClose" class="px-3 py-2 rounded-xl glass text-sm font-bold hover:opacity-90">Close</button>
    </div>
    <div class="p-4 overflow-auto h-[calc(100%-64px)]">
      <div class="muted text-xs uppercase tracking-wider">Recent trades</div>
      <table class="w-full text-sm mt-2">
        <thead class="text-xs muted">
          <tr>
            <th class="text-left py-2">Time</th>
            <th class="text-left py-2">Side</th>
            <th class="text-left py-2">Symbol</th>
            <th class="text-left py-2">Qty</th>
            <th class="text-left py-2">Price</th>
          </tr>
        </thead>
        <tbody id="drawerBody">
          <tr><td class="py-3 muted" colspan="5">Loading…</td></tr>
        </tbody>
      </table>
      <div class="mt-4 muted text-xs">
        Hover the War Room trade stream “Why” for reasoning; learning verdicts are evaluated after the configured horizon.
      </div>
    </div>
  </div>

  <script src="/war-room.js"></script>
</body>
</html>
